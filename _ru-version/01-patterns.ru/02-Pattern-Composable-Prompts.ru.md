# Паттерн «Компонуемые Промпты»

## 1. Контекст

По мере усложнения инструкций для ИИ-агентов («мета-промптов»), их жесткое кодирование в автоматизированных скриптах становится негибким и нарушает принцип "Не повторяйся" (DRY). Если нескольким скриптам требуется общий набор инструкций (например, системная преамбула), этот общий текст пришлось бы дублировать, что создает бремя в обслуживании.

## 2. Паттерн

Паттерн **«Компонуемые Промпты»** решает эту проблему, применяя принципы инженерии программного обеспечения к управлению промптами. Он создает систему, в которой шаблоны промптов являются внешними, декларативными файлами, которые могут импортировать и компоновать многоразовые компоненты.

Эта архитектура требует двух ключевых компонентов:

1.  **Инструмент-препроцессор:** Скрипт или инструмент сборки, который разработан для понимания пользовательской директивы включения (например, `@import "path/to/partial.md"`). Его основная задача — прочитать основной файл шаблона, найти все такие директивы и рекурсивно заменить их содержимым указанных «частичных» файлов. Этот процесс создает единую, полностью «скомпилированную» строку промпта.

2.  **Компонуемая файловая структура:** Выделенный каталог для шаблонов (например, `prompt-templates/`), который содержит:
    *   **Основные шаблоны:** Эти файлы определяют высокоуровневую структуру для определенного типа промпта (например, `spec-compiler-prompt.md`). Они являются декларативными и содержат директивы включения для компоновки конечного промпта.
    *   **Частичные файлы (`_partials/`):** Эти файлы содержат многоразовые фрагменты текста (например, `system-preamble.md`). Они являются единственным источником истины для любого инструктивного текста, который должен быть общим для нескольких основных шаблонов.

## 3. Преимущества

*   **Поддерживаемость:** Общие инструкции определены только в одном месте. Обновление основного определения требует редактирования только одного файла `_partial`.
*   **Масштабируемость:** Новые шаблоны промптов можно легко и быстро создавать, компонуя существующие частичные файлы.
*   **Разделение ответственности:** «Движок» (инструмент-препроцессор) четко отделен от «конфигурации» (шаблоны промптов в формате Markdown), что позволяет инженерам по промптам изменять инструкции ИИ без изменения какого-либо кода.

## 4. Пример реализации

Данный паттерн реализован в каталоге `idgl-dev-system/02-implementation/scripts/`. Скрипт `idgl-template-engine.ps1` служит препроцессором для директивы `@import`. Каталог `prompt-templates/` содержит основной шаблон `spec-compiler.md` и его импортируемый частичный файл `_partials/preamble-spec-definition.md`.
